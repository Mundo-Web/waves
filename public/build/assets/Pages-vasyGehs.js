var I=Object.defineProperty;var q=(r,n,i)=>n in r?I(r,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[n]=i;var y=(r,n,i)=>(q(r,typeof n!="symbol"?n+"":n,i),i);import{r as l,R as t,C as U,c as z}from"./CreateReactScript-BRBWlRTV.js";import{R as N}from"./ReactAppend-PRxIKL2F.js";import{B as O,A as J,i as k,S as L}from"./Adminto-BQEdF9zl.js";import{M as V}from"./Modal-CYscrTZ-.js";import{T as H,D as P}from"./DxPanelButton-j7iIpq-x.js";import{I as A}from"./InputFormGroup-Bwc1l4v7.js";import{T as K}from"./TextareaFormGroup-CQXxCfbs.js";import{T as G}from"./TippyButton-BFYLHq91.js";import{S as Q}from"./SelectFormGroup-Bc4KUn6R.js";import{r as W}from"./server.browser-DGOuh5si.js";class X extends O{constructor(){super(...arguments);y(this,"path","pages");y(this,"hasFiles",!0)}}const F=({id:r,col:n,label:i,eRef:o,required:f=!1,onChange:g=()=>{},aspect:d="21/9",fit:b="cover",width:E="100%",height:m,containerStyle:p,onError:u="/api/cover/thumbnail/null"})=>{r||(r=`ck-${crypto.randomUUID()}`),o||(o=l.useRef());const h=l.useRef(),x=async c=>{const v=c.target.files[0],w=await File.toURL(v);h.current.src=w,g(c)};return l.useEffect(()=>{o.image=h.current},[null]),t.createElement("div",{className:`form-group ${n} mb-1`,style:p},t.createElement("label",{htmlFor:r,className:"d-block"},i," ",f&&t.createElement("b",{className:"text-danger"},"*")),t.createElement("label",{className:"d-block",htmlFor:r,style:{width:"max-content"}},t.createElement("img",{ref:h,className:"d-block",src:"",alt:"aspect-video",onError:c=>c.target.src=u,style:{width:E,height:m,borderRadius:"4px",cursor:"pointer",aspectRatio:d,objectFit:b,objectPosition:"center"}})),t.createElement("input",{ref:o,id:r,type:"file",src:"",alt:"",hidden:!0,accept:"image/*",onChange:x}))},S=new X,Y=({subdomains:r,subdomain:n,can:i})=>{const o=l.useRef(),f=l.useRef(),g=l.useRef(),d=l.useRef(),b=l.useRef(),E=l.useRef(),m=l.useRef(),p=l.useRef(),u=l.useRef(),[h,x]=l.useState(!1),c=e=>{e!=null&&e.id?x(!0):x(!1),console.log(e),g.current.value=(e==null?void 0:e.id)||null,b.current.value=(e==null?void 0:e.path)||"",d.current.value=(e==null?void 0:e.name)||"",E.current.value=(e==null?void 0:e.description)||"",m.image.src=`/api/pages/media/${e.img_desktop}`,p.image.src=`/api/pages/media/${e.img_tablet}`,u.image.src=`/api/pages/media/${e.img_mobile}`,m.current.value=null,p.current.value=null,u.current.value=null,$(f.current).modal("show")},v=async e=>{var _,B,j;e.preventDefault();const a={id:g.current.value||void 0,path:b.current.value,name:d.current.value,description:E.current.value??void 0},s=new FormData;for(const M in a)s.append(M,a[M]);const R=((_=m.current.files)==null?void 0:_[0])??null,T=((B=p.current.files)==null?void 0:B[0])??null,C=((j=u.current.files)==null?void 0:j[0])??null;R&&s.append("img_desktop",R),T&&s.append("img_tablet",T),C&&s.append("img_mobile",C),await S.save(s)&&($(o.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"))},w=async e=>{const{isConfirmed:a}=await L.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!a||!await S.delete(e)||$(o.current).dxDataGrid("instance").refresh()},D=({id:e,text:a,element:s})=>{if(!e)return a;const R=$(s).data("option");return $(W(t.createElement("div",null,t.createElement("b",{className:"d-block"},a," ",t.createElement("code",null,R.correlative)),t.createElement("small",{className:"d-block text-truncate w-100"},R.description||"Sin descripción larga larguisima de todos modos larog"))))};return t.createElement(t.Fragment,null,t.createElement("div",{className:"row"},t.createElement("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-12 mb-2"},t.createElement(Q,{minimumResultsForSearch:-1,templateResult:D,templateSelection:D,onChange:e=>setSelectedMonth(e.target.value)},r.map((e,a)=>t.createElement("option",{key:a,value:e.correlative,"data-option":JSON.stringify(e)},e.name))))),t.createElement(H,{gridRef:o,title:`Páginas - ${n.name}`,rest:S,toolBar:e=>{e.unshift(P({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(o.current).dxDataGrid("instance").refresh()})),i("pages","all","create")&&e.unshift(P({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>c()}))},filterValue:["subdomain_id","=",n.id],columns:[{dataField:"subdomain_id",visible:!1},{dataField:"path",caption:"Ruta"},{dataField:"name",caption:"Nombre"},{dataField:"description",caption:"Descripcion"},{dataField:"images",caption:"Imagenes",allowFiltering:!1,width:"200px",cellTemplate:(e,{data:a})=>{N(e,t.createElement("div",{className:"d-flex gap-1"},t.createElement(k,{content:"Desktop"},t.createElement("img",{src:`/api/pages/media/${a.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:16/9,objectFit:"cover",objectPosition:"top center"}})),t.createElement(k,{content:"Tablet"},t.createElement("img",{src:`/api/pages/media/${a.img_tablet||a.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:4/3,objectFit:"cover",objectPosition:"top center"}})),t.createElement(k,{content:"Mobile"},t.createElement("img",{src:`/api/pages/media/${a.img_mobile||a.img_tablet||a.img_desktop}`,className:"border",style:{height:"40px",aspectRatio:9/16,objectFit:"cover",objectPosition:"top center"}}))))}},{caption:"Acciones",cellTemplate:(e,{data:a})=>{e.attr("style","display: flex; gap: 4px; overflow: unset; height: 51px"),N(e,t.createElement(G,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>c(a)},t.createElement("i",{className:"fa fa-pen"}))),N(e,t.createElement(G,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>w(a.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(V,{modalRef:f,title:h?"Editar página":"Agregar página",onSubmit:v,size:"sm"},t.createElement("input",{ref:g,type:"hidden"}),t.createElement(A,{eRef:b,label:"Ruta",col:"col-12",required:!0}),t.createElement(A,{eRef:d,label:"Nombre",col:"col-12",required:!0}),t.createElement(K,{eRef:E,label:"Descripcion",col:"col-12",rows:2}),t.createElement("div",{className:"d-flex flex-wrap justify-content-start gap-2"},t.createElement(F,{eRef:m,label:"Desktop",aspect:16/9,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}),t.createElement(F,{eRef:p,label:"Tablet",aspect:4/3,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}),t.createElement(F,{eRef:u,label:"Mobile",aspect:9/16,height:"50px",width:"auto",containerStyle:{width:"max-content"},onError:"/api/pages/media/undefined"}))))};U((r,n)=>{z(r).render(t.createElement(J,{...n,title:"Páginas"},t.createElement(Y,{...n})))});
