var x=Object.defineProperty;var C=(r,t,a)=>t in r?x(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a;var v=(r,t,a)=>(C(r,typeof t!="symbol"?t+"":t,a),a);import{m as c,C as F,c as S,R as e,r as d}from"./CreateReactScript-CVY3HzKt.js";import{A as P,i as $}from"./Adminto-3c-f_6jB.js";import{I as p}from"./InputFormGroup-CgbdyySZ.js";class E{}v(E,"save",async t=>{try{const{status:a,result:o}=await c.Fetch("/api/profile",{method:"PATCH",body:JSON.stringify(t)});if(!a)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(a){return c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:a.message,type:"danger"}),!1}});const O=r=>{const t=d.useRef(),a=d.useRef(),o=d.useRef(),[s,b]=d.useState(r.session),N=async u=>{u.preventDefault();const n={name:t.current.value,lastname:a.current.value,birthdate:o.current.value};if(!await E.save(n))return;const l=structuredClone(s);l.name=n.name,l.lastname=n.lastname,l.birthdate=n.birthdate,b(l)},w=async u=>{const n=u.target.files[0];if(n)try{const{full:i,thumbnail:l,type:g,ok:R}=await File.compress(n);if(!R)throw new Error("Ocurrio un error al comprimir la imagen. Intenta con otra.");const f=new FormData;f.append("thumbnail",await File.fromURL(`data:${g};base64,${l}`)),f.append("full",await File.fromURL(`data:${g};base64,${i}`));const y=await fetch("/api/profile",{method:"POST",headers:{"X-Xsrf-Token":decodeURIComponent(c.Cookies.get("XSRF-TOKEN"))},body:f}),m=c.JSON.parseable(await y.text());if(!y.ok)throw new Error((m==null?void 0:m.message)??"Ocurrio un error inesperado");const h=structuredClone(s);h.relative_id=m.data.relative_id,b(h),c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:"La imagen de perfil se actualizo correctamente",type:"success"})}catch(i){c.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:i.message,type:"danger"})}};return e.createElement(P,{...r,title:"Perfil de usuario",session:s},e.createElement("div",{className:"row justify-content-center align-items-center",style:{height:"calc(100vh - 135px)"}},e.createElement("div",{className:"col-xl-3 col-lg-4 col-md-6 col-sm-8 col-xs-12"},e.createElement("form",{className:"card",onSubmit:N},e.createElement("div",{className:"card-header"},e.createElement("h4",{className:"card-title mb-0"},"Perfil")),e.createElement("div",{className:"card-body"},e.createElement($,{content:"Cambiar foto de perfil",arrow:!0},e.createElement("label",{htmlFor:"avatar",className:"rounded-circle mx-auto d-block",style:{cursor:"pointer",width:"max-content"}},e.createElement("input",{className:"d-none",type:"file",name:"avatar",id:"avatar",accept:"image/*",onChange:w}),e.createElement("img",{className:"avatar-xl rounded-circle",src:`api/profile/${s.relative_id}?v=${crypto.randomUUID()}`,alt:`Perfil de ${s.name} ${s.lastname}`,style:{objectFit:"cover",objectPosition:"center"}}))),e.createElement("hr",{className:"mt-3 mb-2"}),e.createElement(p,{eRef:t,label:"Nombres",value:s.name,required:!0}),e.createElement(p,{eRef:a,label:"Apellidos",value:s.lastname,required:!0}),e.createElement(p,{eRef:o,label:"Fecha de nacimiento",value:s.birthdate,type:"date",required:!0}),e.createElement("div",{className:"text-center"},e.createElement("button",{className:"btn btn-primary btn-block",type:"submit"},e.createElement("i",{className:"fa fa-save"})," Actualizar")),e.createElement("hr",{className:"mt-3 mb-2"}),e.createElement("p",{className:"card-text text-center"},e.createElement("small",{className:"text-muted"},"Ultima actualizacion ",moment(s.updated_at).fromNow())))))))};F((r,t)=>{S(r).render(e.createElement(O,{...t}))});
