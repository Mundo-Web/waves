var P=Object.defineProperty;var _=(s,i,l)=>i in s?P(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l;var T=(s,i,l)=>(_(s,typeof i!="symbol"?i+"":i,l),l);import{r as n,R as e,C as I,c as W}from"./CreateReactScript-CVY3HzKt.js";import{R as N}from"./ReactAppend-CDtf6x3y.js";import{P as j}from"./PermissionsRest-DYCdOFsQ.js";import{B as L,A as O,S as Y}from"./Adminto-CFuhAGWx.js";import{M as A}from"./Modal-CBdtmnYV.js";import{T as H,D as F}from"./DxPanelButton-iWpIUwKx.js";import{I as K}from"./InputFormGroup-CgbdyySZ.js";import{T as U}from"./TextareaFormGroup-prMXhYrp.js";import{T as R}from"./TippyButton-CnFim1Gl.js";import{S as J}from"./SelectFormGroup-dxUp-DLT.js";import{E as Q}from"./Editor-oElHw87E.js";import"./server.browser-BDv8EdO-.js";import"./index-DE8gkn8h.js";class X extends L{constructor(){super(...arguments);T(this,"path","templates")}}const Z=({col:s,label:i,eRef:l,editorRef:c,placeholder:g,required:d=!1,rows:E=6,value:o="",onChange:y=()=>{}})=>{const[h,p]=n.useState(o),v=n.useRef(),r=c||n.useRef(),f=l||v;return n.useEffect(()=>(r.current&&(r.current.toTextArea(),r.current=null),r.current=CodeMirror.fromTextArea(f.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2,lineNumbers:!0}),r.current.setSize(null,600),r.current.setValue(o),setTimeout(()=>{r.current.refresh()},125),r.current.on("change",m=>{const u=m.getValue();p(u),y({target:{value:u}})}),()=>{r.current&&(r.current.toTextArea(),r.current=null)}),[f]),n.useEffect(()=>{h!==o&&(p(o),r.current&&(r.current.setValue(o),setTimeout(()=>{r.current.refresh()},125)))},[o]),e.createElement("div",{className:`form-group ${s} mb-2`},i&&e.createElement("label",{htmlFor:"",className:"mb-1"},i," ",d&&e.createElement("b",{className:"text-danger"},"*")),e.createElement("textarea",{ref:f,className:"form-control",placeholder:g,required:d,rows:E,defaultValue:o,onChange:m=>p(m.target.value)}))},b=new X,ee=({})=>{const s=n.useRef(),i=n.useRef(),l=n.useRef(),c=n.useRef(),g=n.useRef(),d=n.useRef(),E=n.useRef(),o=n.useRef(),[y,h]=n.useState(!1),[p,v]=n.useState({}),[r,f]=n.useState("wysiwyg"),[m,u]=n.useState(""),[C,D]=n.useState(""),[k,S]=n.useState(""),z=t=>{t!=null&&t.id?h(!0):h(!1),g.current.value=(t==null?void 0:t.id)||null,$(d.current).val((t==null?void 0:t.type)||null).trigger("change"),E.current.value=(t==null?void 0:t.name)||null,o.current.value=(t==null?void 0:t.description)||null,$(i.current).modal("show")},B=async t=>{const a=await b.get(t.id);v(a),f("wysiwyg"),u((a==null?void 0:a.content)??"<i>- Agrega tu contenido aqui -</i>"),$(l.current).modal("show")},q=async t=>{t.preventDefault();const a={id:g.current.value||void 0,type:d.current.value,name:E.current.value,description:o.current.value};await b.save(a)&&($(s.current).dxDataGrid("instance").refresh(),$(i.current).modal("hide"))},G=async t=>{t.preventDefault();const a=[...$("#permissions input:checked")].map(V=>V.value),w={role_id:p.id,permissions:a};await j.massiveByRole(w)&&($(l.current).modal("hide"),$(s.current).dxDataGrid("instance").refresh())},M=async t=>{const{isConfirmed:a}=await Y.fire({title:"Eliminar registro",text:"¿Está seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!a||!await b.delete(t)||$(s.current).dxDataGrid("instance").refresh()},x=t=>{f(a=>(a=="wysiwyg"&&t=="code"?(c.current.setValue(m),setTimeout(()=>{c.current.refresh()},125)):a=="wysiwyg"&&t=="dropzone"?S(m):a=="code"&&t=="wysiwyg"?u(C):a=="code"&&t=="dropzone"?S(C):a=="dropzone"&&t=="wysiwyg"?u(k):a=="dropzone"&&t=="code"&&(c.current.setValue(k),setTimeout(()=>{c.current.refresh()},125)),t))};return e.createElement(e.Fragment,null,e.createElement(H,{gridRef:s,title:"Plantillas",rest:b,toolBar:t=>{t.unshift(F({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(s.current).dxDataGrid("instance").refresh()})),t.unshift(F({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>z()}))},columns:[{dataField:"name",caption:"Nombre"},{dataField:"description",caption:"Descripcion"},{dataField:"type",caption:"Tipo"},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(t,{data:a})=>{t.text(moment(a.updated_at).format("LL"))}},{caption:"Acciones",cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: unset"),N(t,e.createElement(R,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>z(a)},e.createElement("i",{className:"fa fa-pen"}))),N(t,e.createElement(R,{className:"btn btn-xs btn-soft-dark",title:"Diseñar plantilla",onClick:()=>B(a),"data-loading-text":'<i className="fa fa-spinner fa-spin"></i>'},e.createElement("i",{className:"far fa-edit"}))),N(t,e.createElement(R,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>M(a.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(A,{modalRef:i,title:y?"Editar plantilla":"Agregar plantilla",onSubmit:q,size:"sm"},e.createElement("div",{className:"row",id:"template-container"},e.createElement("input",{ref:g,type:"hidden"}),e.createElement(J,{eRef:d,label:"Tipo",dropdownParent:"#template-container",required:!0},e.createElement("option",{value:""},"- Seleccione una opcion -"),e.createElement("option",{value:"Email"},"Email"),e.createElement("option",{value:"WhatsApp"},"WhatsApp")),e.createElement(K,{eRef:E,label:"Nombre",required:!0}),e.createElement(U,{eRef:o,label:"Descripcion"}))),e.createElement(A,{modalRef:l,title:`Diseñador de plantillas - ${p.name}`,btnSubmitText:"Guardar",onSubmit:G,size:"xl",isStatic:!0},e.createElement("ul",{className:"nav nav-pills navtab-bg justify-content-center flex-wrap gap-1"},e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#wysiwyg-editor",className:`nav-link text-center ${r=="wysiwyg"?"active":""}`,style:{width:"200px"},onClick:()=>x("wysiwyg")},e.createElement("i",{className:"mdi mdi-page-layout-header-footer me-1"}),"Editor WYSIWYG")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#code-editor",className:`nav-link text-center ${r=="code"?"active":""}`,style:{width:"200px"},onClick:()=>x("code")},e.createElement("i",{className:"mdi mdi-code-tags me-1"}),"Editor de codigo")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#dropzone",className:`nav-link text-center ${r=="dropzone"?"active":""}`,style:{width:"200px"},onClick:()=>x("dropzone")},e.createElement("i",{className:"mdi mdi-cloud-upload me-1"}),"Carga tu archivo"))),e.createElement("div",{className:"tab-content"},e.createElement("div",{className:`tab-pane ${r=="wysiwyg"?"active":""}`,id:"wysiwyg-editor"},e.createElement(Q,{apiKey:"f484gu1eoy1zpp3q58sgxeoqp5ls32g4sq5b6d0xehi13sra",init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],ai_request:(t,a)=>a.string(()=>Promise.reject("See docs to implement AI Assistant")),height:"600px"},value:m,onEditorChange:t=>u(t)}),e.createElement("div",{className:"mb-2"})),e.createElement("div",{className:`tab-pane ${r=="code"?"active":""}`,id:"code-editor"},e.createElement(Z,{editorRef:c,onChange:t=>D(t.target.value)})),e.createElement("div",{className:`tab-pane ${r=="dropzone"?"active":""}`,id:"dropzone"},e.createElement("div",{className:"d-flex align-items-center justify-content-center mb-2 border",style:{height:"600px",borderRadius:"10px"}},e.createElement("div",null,e.createElement("input",{className:"d-none",id:"dropzone-file",type:"file",accept:"text/html,text/plain"}),e.createElement("label",{htmlFor:"dropzone-file",className:"d-block mx-auto mb-2 btn btn-sm btn-white rounded-pill waves-effect",style:{width:"max-content"}},e.createElement("i",{className:"mdi mdi-paperclip me-1"}),"Seleccionar archivo"),e.createElement("label",{htmlFor:"dropzone-file",className:"d-block",style:{cursor:"pointer"}},"Arrastra y suelta tu plantilla aquí, o haz clic para seleccionar tu archivo HTML.")))))))};I((s,i)=>{W(s).render(e.createElement(O,{...i,title:"Plantillas"},e.createElement(ee,{...i})))});
