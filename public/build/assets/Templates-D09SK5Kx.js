var _=Object.defineProperty;var I=(s,r,l)=>r in s?_(s,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[r]=l;var A=(s,r,l)=>(I(s,typeof r!="symbol"?r+"":r,l),l);import{r as n,R as e,C as W,c as j}from"./CreateReactScript-CVY3HzKt.js";import{R}from"./ReactAppend-CDtf6x3y.js";import{P as L}from"./PermissionsRest-DYCdOFsQ.js";import{B as O,A as Y,S as H}from"./Adminto-CFuhAGWx.js";import{M as F}from"./Modal-CBdtmnYV.js";import{T as K,D}from"./DxPanelButton-iWpIUwKx.js";import{I as U}from"./InputFormGroup-CgbdyySZ.js";import{T as J}from"./TextareaFormGroup-prMXhYrp.js";import{T as C}from"./TippyButton-CnFim1Gl.js";import{S as Q}from"./SelectFormGroup-dxUp-DLT.js";import{E as X}from"./Editor-oElHw87E.js";import"./server.browser-BDv8EdO-.js";import"./index-DE8gkn8h.js";class Z extends O{constructor(){super(...arguments);A(this,"path","templates")}}const ee=({col:s,label:r,eRef:l,editorRef:E,placeholder:m,required:u=!1,rows:g=6,value:o="",onChange:h=()=>{}})=>{const[x,d]=n.useState(o),b=n.useRef(),i=E||n.useRef(),c=l||b;return n.useEffect(()=>(i.current&&(i.current.toTextArea(),i.current=null),i.current=CodeMirror.fromTextArea(c.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2,lineNumbers:!0}),i.current.setSize(null,600),i.current.setValue(o),setTimeout(()=>{i.current.refresh()},125),i.current.on("change",p=>{const f=p.getValue();d(f),h({target:{value:f}})}),()=>{i.current&&(i.current.toTextArea(),i.current=null)}),[c]),n.useEffect(()=>{x!==o&&(d(o),i.current&&(i.current.setValue(o),setTimeout(()=>{i.current.refresh()},125)))},[o]),e.createElement("div",{className:`form-group ${s} mb-2`},r&&e.createElement("label",{htmlFor:"",className:"mb-1"},r," ",u&&e.createElement("b",{className:"text-danger"},"*")),e.createElement("textarea",{ref:c,className:"form-control",placeholder:m,required:u,rows:g,defaultValue:o,onChange:p=>d(p.target.value)}))},v=new Z,te=({TINYMCE_KEY:s})=>{const r=n.useRef(),l=n.useRef(),E=n.useRef(),m=n.useRef(),u=n.useRef(),g=n.useRef(),o=n.useRef(),h=n.useRef(),[x,d]=n.useState(!1),[b,i]=n.useState({}),[c,p]=n.useState("wysiwyg"),[f,y]=n.useState(""),[k,B]=n.useState(""),[S,z]=n.useState(""),T=t=>{t!=null&&t.id?d(!0):d(!1),u.current.value=(t==null?void 0:t.id)||null,$(g.current).val((t==null?void 0:t.type)||null).trigger("change"),o.current.value=(t==null?void 0:t.name)||null,h.current.value=(t==null?void 0:t.description)||null,$(l.current).modal("show")},G=async t=>{const a=await v.get(t.id);i(a),p("wysiwyg"),y((a==null?void 0:a.content)??"<i>- Agrega tu contenido aqui -</i>"),$(E.current).modal("show")},M=async t=>{t.preventDefault();const a={id:u.current.value||void 0,type:g.current.value,name:o.current.value,description:h.current.value};await v.save(a)&&($(r.current).dxDataGrid("instance").refresh(),$(l.current).modal("hide"))},V=async t=>{t.preventDefault();const a=[...$("#permissions input:checked")].map(P=>P.value),N={role_id:b.id,permissions:a};await L.massiveByRole(N)&&($(E.current).modal("hide"),$(r.current).dxDataGrid("instance").refresh())},q=async t=>{const{isConfirmed:a}=await H.fire({title:"Eliminar registro",text:"¿Está seguro de eliminar este registro?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!a||!await v.delete(t)||$(r.current).dxDataGrid("instance").refresh()},w=t=>{p(a=>(a=="wysiwyg"&&t=="code"?(m.current.setValue(f),setTimeout(()=>{m.current.refresh()},125)):a=="wysiwyg"&&t=="dropzone"?z(f):a=="code"&&t=="wysiwyg"?y(k):a=="code"&&t=="dropzone"?z(k):a=="dropzone"&&t=="wysiwyg"?y(S):a=="dropzone"&&t=="code"&&(m.current.setValue(S),setTimeout(()=>{m.current.refresh()},125)),t))};return e.createElement(e.Fragment,null,e.createElement(K,{gridRef:r,title:"Plantillas",rest:v,toolBar:t=>{t.unshift(D({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(r.current).dxDataGrid("instance").refresh()})),t.unshift(D({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>T()}))},columns:[{dataField:"name",caption:"Nombre"},{dataField:"description",caption:"Descripcion"},{dataField:"type",caption:"Tipo"},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(t,{data:a})=>{t.text(moment(a.updated_at).format("LL"))}},{caption:"Acciones",cellTemplate:(t,{data:a})=>{t.attr("style","display: flex; gap: 4px; overflow: unset"),R(t,e.createElement(C,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>T(a)},e.createElement("i",{className:"fa fa-pen"}))),R(t,e.createElement(C,{className:"btn btn-xs btn-soft-dark",title:"Diseñar plantilla",onClick:()=>G(a),"data-loading-text":'<i className="fa fa-spinner fa-spin"></i>'},e.createElement("i",{className:"far fa-edit"}))),R(t,e.createElement(C,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>q(a.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(F,{modalRef:l,title:x?"Editar plantilla":"Agregar plantilla",onSubmit:M,size:"sm"},e.createElement("div",{className:"row",id:"template-container"},e.createElement("input",{ref:u,type:"hidden"}),e.createElement(Q,{eRef:g,label:"Tipo",dropdownParent:"#template-container",required:!0},e.createElement("option",{value:""},"- Seleccione una opcion -"),e.createElement("option",{value:"Email"},"Email"),e.createElement("option",{value:"WhatsApp"},"WhatsApp")),e.createElement(U,{eRef:o,label:"Nombre",required:!0}),e.createElement(J,{eRef:h,label:"Descripcion"}))),e.createElement(F,{modalRef:E,title:`Diseñador de plantillas - ${b.name}`,btnSubmitText:"Guardar",onSubmit:V,size:"xl",isStatic:!0},e.createElement("ul",{className:"nav nav-pills navtab-bg justify-content-center flex-wrap gap-1"},e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#wysiwyg-editor",className:`nav-link text-center ${c=="wysiwyg"?"active":""}`,style:{width:"200px"},onClick:()=>w("wysiwyg")},e.createElement("i",{className:"mdi mdi-page-layout-header-footer me-1"}),"Editor WYSIWYG")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#code-editor",className:`nav-link text-center ${c=="code"?"active":""}`,style:{width:"200px"},onClick:()=>w("code")},e.createElement("i",{className:"mdi mdi-code-tags me-1"}),"Editor de codigo")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#dropzone",className:`nav-link text-center ${c=="dropzone"?"active":""}`,style:{width:"200px"},onClick:()=>w("dropzone")},e.createElement("i",{className:"mdi mdi-cloud-upload me-1"}),"Carga tu archivo"))),e.createElement("div",{className:"tab-content"},e.createElement("div",{className:`tab-pane ${c=="wysiwyg"?"active":""}`,id:"wysiwyg-editor"},e.createElement(X,{apiKey:s,init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],ai_request:(t,a)=>a.string(()=>Promise.reject("See docs to implement AI Assistant")),height:"600px"},value:f,onEditorChange:t=>y(t)}),e.createElement("div",{className:"mb-2"})),e.createElement("div",{className:`tab-pane ${c=="code"?"active":""}`,id:"code-editor"},e.createElement(ee,{editorRef:m,onChange:t=>B(t.target.value)})),e.createElement("div",{className:`tab-pane ${c=="dropzone"?"active":""}`,id:"dropzone"},e.createElement("div",{className:"d-flex align-items-center justify-content-center mb-2 border",style:{height:"600px",borderRadius:"10px"}},e.createElement("div",null,e.createElement("input",{className:"d-none",id:"dropzone-file",type:"file",accept:"text/html,text/plain"}),e.createElement("label",{htmlFor:"dropzone-file",className:"d-block mx-auto mb-2 btn btn-sm btn-white rounded-pill waves-effect",style:{width:"max-content"}},e.createElement("i",{className:"mdi mdi-paperclip me-1"}),"Seleccionar archivo"),e.createElement("label",{htmlFor:"dropzone-file",className:"d-block",style:{cursor:"pointer"}},"Arrastra y suelta tu plantilla aquí, o haz clic para seleccionar tu archivo HTML.")))))))};W((s,r)=>{j(s).render(e.createElement(Y,{...r,title:"Plantillas"},e.createElement(te,{...r})))});
