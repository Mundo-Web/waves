var J=Object.defineProperty;var K=(s,r,a)=>r in s?J(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a;var P=(s,r,a)=>(K(s,typeof r!="symbol"?r+"":r,a),a);import{m as v,r as n,R as e,C as Y,c as Q}from"./CreateReactScript-CVY3HzKt.js";import{B as X,i as b,A as Z}from"./Adminto-3c-f_6jB.js";import{M}from"./Modal-CBdtmnYV.js";import{I as m}from"./InputFormGroup-CgbdyySZ.js";import{T as ee}from"./TextareaFormGroup-prMXhYrp.js";import{g as te}from"./google-K1CXqkDy.js";class W extends X{constructor(){super(...arguments);P(this,"path","sessions");P(this,"verify",async(a,i)=>{try{const{status:c,result:u}=await v.Fetch(`/api/${this.path}/${a}`);if(!c)throw new Error((u==null?void 0:u.message)??"Ocurrio un error al verificar la sesion");return!0}catch(c){return console.error(c.message),i&&v.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:c.message,type:"danger"}),!1}});P(this,"ping",async a=>{try{const{status:i,result:c}=await v.Fetch(`/api/${this.path}/ping`,{method:"POST",body:JSON.stringify(a)});if(!i)throw new Error((c==null?void 0:c.message)??"Ocurrio un error al enviar el ping");v.Notify.add({icon:"/assets/img/icon.svg",title:"Correcto",body:`El ping ha sido enviado correctamente a ${a.to}`,type:"success"})}catch(i){v.Notify.add({icon:"/assets/img/icon.svg",title:"Error",body:i.message,type:"danger"})}})}}const ae=new W,ne=({onModalOpen:s,onPingModalOpen:r,...a})=>{var f;const[i,c]=n.useState(null);n.useEffect(()=>{u()},[null]);const u=async(y=!1)=>{c(null);const E=await ae.verify(a.id,y);c(E)};return e.createElement("div",{className:"card"},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("div",{className:"flex-grow-1 overflow-hidden"},e.createElement("h5",{className:"my-0"},i==null?e.createElement("i",{className:"mdi mdi-circle me-1 text-muted"}):e.createElement(e.Fragment,null,i?e.createElement("i",{className:"mdi mdi-circle me-1 text-success"}):e.createElement(b,{content:"Verificar"},e.createElement("i",{className:"mdi mdi-circle me-1 text-danger",style:{cursor:"pointer"},onClick:()=>u(!0)}))),a==null?void 0:a.name),e.createElement("p",{className:"text-muted mb-2 font-13 text-truncate"},((f=a==null?void 0:a.metadata)==null?void 0:f.email)??"-"),e.createElement("div",{className:"d-flex flex-wrap gap-1"},i&&e.createElement(b,{content:"Ping"},e.createElement("button",{className:"btn btn-xs btn-dark rounded-pill waves-effect",onClick:()=>r(a)},e.createElement("i",{className:"mdi mdi-signal-variant"}))),e.createElement(b,{content:"Editar"},e.createElement("button",{className:"btn btn-xs btn-primary rounded-pill waves-effect",onClick:()=>s(a)},e.createElement("i",{className:"mdi mdi-pencil"}))),e.createElement(b,{content:"Desactivar"},e.createElement("button",{className:"btn btn-xs btn-light rounded-pill waves-effect"},e.createElement("i",{className:"mdi mdi-toggle-switch text-success"}))))))))},O=new W,le=({sessions:s=[]})=>{const r=n.useRef(),a=n.useRef(),i=n.useRef(),c=n.useRef(),u=n.useRef(),f=n.useRef(),y=n.useRef(),E=n.useRef(),I=n.useRef(),S=n.useRef(),U=n.useRef(),D=n.useRef(),R=n.useRef(),h=n.useRef(),N=n.useRef(),w=n.useRef(),x=n.useRef(),k=n.useRef(),[H,L]=n.useState(s),[o,T]=n.useState(null),[d,_]=n.useState(null),A=t=>{var l,p,g,C,F,j,q,G;switch(T((t==null?void 0:t.type)??null),I.current.value=(t==null?void 0:t.id)??"",S.current.value=(t==null?void 0:t.name)??"",U.current.value=(t==null?void 0:t.alias)??"",D.current.value=(t==null?void 0:t.description)??"",_(((l=t==null?void 0:t.metadata)==null?void 0:l.type)??"integration"),x.current.value="",k.current.value="",R.current.value="",h.current.value="",N.current.value="",w.current.value="",(p=t==null?void 0:t.metadata)==null?void 0:p.type){case"gmail":x.current.value=((g=t==null?void 0:t.metadata)==null?void 0:g.email)??"",k.current.value=((C=t==null?void 0:t.metadata)==null?void 0:C.password)??"";break;case"google":break;default:R.current.value=((F=t==null?void 0:t.metadata)==null?void 0:F.host)??"",h.current.value=((j=t==null?void 0:t.metadata)==null?void 0:j.port)??"",N.current.value=((q=t==null?void 0:t.metadata)==null?void 0:q.email)??"",w.current.value=((G=t==null?void 0:t.metadata)==null?void 0:G.password)??"";break}$(r.current).modal("show")},B=async t=>{t.preventDefault();const l={id:I.current.value||void 0,type:o,name:S.current.value,alias:U.current.value,description:D.current.value,metadata:{type:d}};switch(d){case"gmail":l.metadata.email=x.current.value,l.metadata.password=k.current.value;break;case"google":break;default:l.metadata.host=R.current.value,l.metadata.port=h.current.value,l.metadata.email=N.current.value,l.metadata.password=w.current.value;break}const p=await O.save(l);p&&(L(g=>[...g,p]),$(r.current).modal("hide"))},V=t=>{T(t.type),i.current.textContent=t.name,t.type=="Email"?(u.current.value=t.metadata.email,f.current.value=""):(y.current.value=t.metadata.phone,E.current.value=""),$(a.current).modal("show")},z=async t=>{t.preventDefault();const l={from:c.current.value,to:o=="Email"?f.current.value:E.current.value};await O.ping(l)};return e.createElement(e.Fragment,null,e.createElement("main",{className:"d-flex align-items-center justify-content-center gap-2",style:{height:"calc(100vh - 160px)"}},e.createElement("div",{className:"card btn btn-light waves-effect",onClick:()=>A()},e.createElement("div",{className:"card-body widget-user"},e.createElement("div",{className:"d-flex align-items-center"},e.createElement("div",{className:"flex-grow-1 overflow-hidden"},e.createElement("i",{className:"mdi mdi-plus mdi-24px"}),e.createElement("span",{className:"d-block"},"Nueva cuenta"))))),H.map((t,l)=>e.createElement(ne,{key:l,onModalOpen:A,onPingModalOpen:V,...t}))),e.createElement(M,{modalRef:r,title:`Agregar cuenta${o?` - ${o}`:""}`,hideFooter:!o,onSubmit:B},e.createElement("input",{ref:I,type:"hidden"}),e.createElement("div",{className:`${o?"d-none":"d-flex"} align-items-center gap-3 justify-content-center`,style:{minHeight:"240px"}},["Email","WhatsApp"].map((t,l)=>e.createElement("label",{key:l,className:"d-block position-relative btn btn-light text-center",style:{width:"120px"}},e.createElement("input",{className:"d-none position-absolute",type:"radio",name:"session_type",id:"",value:t,style:{left:"8px",top:"8px"},onChange:p=>T(p.target.value)}),e.createElement("img",{className:"d-block mx-auto mb-1",src:`/assets/img/${t}.svg`,alt:t,style:{width:"50px",aspectRatio:1,objectFit:"contain",objectPosition:"center"}}),e.createElement("span",null,t)))),e.createElement("div",{hidden:!o},e.createElement("div",{className:"row"},e.createElement(m,{eRef:S,label:"Nombre",col:"col-md-8",required:!0}),e.createElement(m,{eRef:U,label:"Alias",col:"col-md-4"}),e.createElement(ee,{eRef:D,label:"Descripcion",required:!0})),e.createElement("div",{hidden:o!="Email"},e.createElement("ul",{id:"email-types",className:"nav nav-pills navtab-bg nav-justified"},e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#email-integration","data-bs-toggle":"tab","aria-expanded":"false",className:`nav-link ${d==null||d=="integration"?"active":""}`},e.createElement("i",{className:"mdi mdi-email me-1"}),"Integracion")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#email-gmail","data-bs-toggle":"tab","aria-expanded":"true",className:`nav-link ${d=="gmail"?"active":""}`},e.createElement("i",{className:"mdi mdi-gmail me-1"}),"Gmail")),e.createElement(b,{content:"Proximamente"},e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#email-google","data-bs-toggle":"tab","aria-expanded":"false",className:`nav-link ${d=="google"?"active":""} disabled`},e.createElement("i",{className:"mdi mdi-google me-1"}),"Google")))),e.createElement("div",{className:"tab-content"},e.createElement("div",{className:`tab-pane ${d=="integration"?"active":""}`,id:"email-integration"},e.createElement("div",{className:"row"},e.createElement(m,{eRef:R,label:"Host",col:"col-md-8"}),e.createElement(m,{eRef:h,label:"Puerto",col:"col-md-4",type:"number"}),e.createElement(m,{eRef:N,label:"Correo"}),e.createElement(m,{eRef:w,label:"Contraseña"}))),e.createElement("div",{className:`tab-pane ${d=="gmail"?"active":""}`,id:"email-gmail"},e.createElement("blockquote",null,"Para obtener una contraseña de aplicación de Gmail acceda a este enlace: ",e.createElement("a",{href:"//myaccount.google.com/apppasswords",target:"_blank"},"myaccount.google.com/apppasswords")),e.createElement(m,{eRef:x,label:"Correo"}),e.createElement(m,{eRef:k,label:"Contraseña de aplicación"})),e.createElement("div",{className:`tab-pane text-center ${d=="google"?"active":""}`,id:"email-google"},e.createElement("p",null,"Necesitamos tu permiso para ",e.createElement("br",null),"acceder a tu correo electrónico. ",e.createElement("br",null),e.createElement("small",{className:"text-muted"},"No te preocupes, tus datos están seguros con nosotros.")),e.createElement("div",{className:"d-flex flex-column justify-content-center align-items-center gap-1"},e.createElement("button",{className:"btn btn-sm btn-primary",type:"button",onClick:()=>setTokenUUID(crypto.randomUUID())},"Ya he iniciado sesión"),e.createElement("button",{className:"btn btn-sm btn-white d-inline-flex align-items-center gap-1",type:"button",onClick:t=>{const l=window.open(googleAuthURI,"_blank"),p=Local.get("tokenUUID"),g=setInterval(()=>{const C=Local.get("tokenUUID");p!=C&&(clearInterval(g),l.close(),setTokenUUID())},[500])}},e.createElement("img",{src:te,alt:"",style:{width:"14px",height:"14px",objectFit:"contain",objectPosition:"center"}}),e.createElement("span",null,"Permitir acceso")))))))),e.createElement(M,{modalRef:a,title:"Ping",size:"sm",onSubmit:z},e.createElement("input",{ref:c,type:"hidden"}),e.createElement("blockquote",null,"Envia un mensaje de prueba con ",e.createElement("b",{ref:i},"sodeword@gmail.com")),e.createElement("div",{hidden:o!="Email"},e.createElement(m,{eRef:u,label:"De:",disabled:!0}),e.createElement(m,{eRef:f,label:"Para:",type:"email"})),e.createElement("div",{hidden:o!="WhatsApp"},e.createElement(m,{eRef:y,label:"De:",type:"tel"}),e.createElement(m,{eRef:E,label:"Para:",type:"tel"}))))};Y((s,r)=>{Q(s).render(e.createElement(Z,{...r,title:"Cuentas"},e.createElement(le,{...r})))});
