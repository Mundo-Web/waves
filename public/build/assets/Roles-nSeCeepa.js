import{R as t,C as A,c as B,r as o}from"./CreateReactScript-CVY3HzKt.js";import{R as p}from"./ReactAppend-CDtf6x3y.js";import{P as k}from"./PermissionsRest-DYCdOFsQ.js";import{R}from"./RolesRest-PyHXorSY.js";import{i as G,A as P,S as M}from"./Adminto-CFuhAGWx.js";import{M as y}from"./Modal-CBdtmnYV.js";import{T as _,D as N}from"./DxPanelButton-2oOfQnG8.js";import{I as L}from"./InputFormGroup-CgbdyySZ.js";import{T as q}from"./TextareaFormGroup-prMXhYrp.js";import{T as x}from"./TippyButton-CnFim1Gl.js";import"./server.browser-BDv8EdO-.js";const z=({title:n,id:a,parent:s,children:c,className:m,isOpened:i})=>t.createElement("div",{className:"card mb-1 border"},t.createElement("div",{className:"card-header p-0",id:`heading-${a}`},t.createElement("h5",{className:"m-0"},t.createElement("a",{className:`d-block text-dark ${!i&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${a}`,"aria-expanded":"false"},n))),t.createElement("div",{id:a,className:`collapse ${i&&"show"}`,"aria-labelledby":`heading-${a}`,"data-bs-parent":`#${s}`},t.createElement("div",{className:`card-body p-2 ${m}`},c))),I=({title:n,label:a,id:s,name:c,value:m,checked:i,required:u,rounded:d=!1,style:h,className:f})=>t.createElement(G,{content:n,arrow:!0},t.createElement("div",{className:`form-check form-check-success ${f}`,style:{...h,cursor:"pointer"}},t.createElement("input",{className:`form-check-input ${d&&"rounded-circle"}`,type:"checkbox",value:m,name:c,id:s,defaultChecked:i,required:u,style:{cursor:"pointer"}}),t.createElement("label",{className:"form-check-label",htmlFor:s,style:{cursor:"pointer"}},a))),O=({permissions:n,can:a})=>{n=Object.values(n.map(e=>{const[r]=e.name.split(".");return{...e,origin:r}}).reduce((e,r)=>(e[r.origin]||(e[r.origin]=[]),e[r.origin].push(r),e),{}));const s=o.useRef(),c=o.useRef(),m=o.useRef();o.useRef();const i=o.useRef(),u=o.useRef(),d=o.useRef(),[h,f]=o.useState(!1),[g,w]=o.useState({}),v=e=>{e!=null&&e.id?f(!0):f(!1),i.current.value=(e==null?void 0:e.id)||null,u.current.value=(e==null?void 0:e.name)||null,d.current.value=(e==null?void 0:e.description)||null,$(c.current).modal("show")},C=async e=>{w(e);const r=await k.byRole(e.id);$("#permissions input").prop("checked",!1),r.forEach(({name:l})=>{$(`[name="${l}"]`).prop("checked",!0)}),$(m.current).modal("show")},T=async e=>{e.preventDefault();const r={id:i.current.value||void 0,name:u.current.value,description:d.current.value};await R.save(r)&&($(s.current).dxDataGrid("instance").refresh(),$(c.current).modal("hide"))},F=async e=>{e.preventDefault();const r=[...$("#permissions input:checked")].map(b=>b.value),l={role_id:g.id,permissions:r};await k.massiveByRole(l)&&($(m.current).modal("hide"),$(s.current).dxDataGrid("instance").refresh())},D=async e=>{const{isConfirmed:r}=await M.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!r||!await R.delete(e)||$(s.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(_,{gridRef:s,title:"Roles",rest:R,toolBar:e=>{e.unshift(N({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(s.current).dxDataGrid("instance").refresh()})),a("roles","all","create")&&e.unshift(N({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>v()}))},columns:[{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",width:"150px",cellTemplate:(e,{data:r})=>{p(e,t.createElement("span",null,moment(r.created_at).format("LL")))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",width:"150px",cellTemplate:(e,{data:r})=>{p(e,t.createElement("span",null,moment(r.updated_at).format("LL")))}},{caption:"Acciones",cellTemplate:(e,{data:r})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),p(e,t.createElement(x,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>v(r)},t.createElement("i",{className:"fa fa-pen"}))),p(e,t.createElement(x,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>C(r),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>'},t.createElement("i",{className:"fas fa-th-list"}))),p(e,t.createElement(x,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>D(r.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(y,{modalRef:c,title:h?"Editar rol":"Agregar rol",onSubmit:T},t.createElement("div",{className:"row"},t.createElement("input",{ref:i,type:"hidden"}),t.createElement(L,{eRef:u,label:"Rol",col:"col-12",required:!0}),t.createElement(q,{eRef:d,label:"Descripcion",col:"col-12"}))),t.createElement(y,{modalRef:m,title:`Permisos para ${g.name}`,btnSubmitText:"Guardar",onSubmit:F,size:"lg"},t.createElement("div",{id:"permissions",className:"row"},n.map((e,r)=>{const l=e[0].origin;return t.createElement("div",{className:"col-lg-4 col-md-6 col-sm-12"},t.createElement(z,{key:`accordion-${r}`,id:`permission-${l}`,title:l,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row",isOpened:!0},e.map(({id:E,name:b,description:S})=>t.createElement(I,{key:`permission-${E}`,className:"mb-0",id:`permission-ck-${E}`,label:b.replace(`${l}.`,""),name:b,value:E,title:S,style:{width:"max-content"},rounded:!0}))))}))))};A((n,a)=>{B(n).render(t.createElement(P,{...a,title:"Roles"},t.createElement(O,{...a})))});
