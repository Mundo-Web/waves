var z=Object.defineProperty;var B=(n,a,i)=>a in n?z(n,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[a]=i;var w=(n,a,i)=>(B(n,typeof a!="symbol"?a+"":a,i),i);import{r,R as e,C as G,c as M}from"./CreateReactScript-CVY3HzKt.js";import{R}from"./ReactAppend-CDtf6x3y.js";import{P}from"./PermissionsRest-DYCdOFsQ.js";import{R as V}from"./RolesRest-PyHXorSY.js";import{B as _,A as q,S as I}from"./Adminto-CFuhAGWx.js";import{M as k}from"./Modal-CBdtmnYV.js";import{T as W,D as T}from"./DxPanelButton-2oOfQnG8.js";import{I as j}from"./InputFormGroup-CgbdyySZ.js";import{T as L}from"./TextareaFormGroup-prMXhYrp.js";import{T as y}from"./TippyButton-CnFim1Gl.js";import{S as O}from"./SelectFormGroup-dxUp-DLT.js";import{E as Y}from"./Editor-oElHw87E.js";import"./server.browser-BDv8EdO-.js";import"./index-DE8gkn8h.js";class H extends _{constructor(){super(...arguments);w(this,"path","templates")}}const K=({col:n,label:a,eRef:i,editorRef:g,placeholder:h,required:u=!1,rows:p=6,value:o="",onChange:f=()=>{}})=>{const[x,d]=r.useState(o),c=r.useRef(),l=g||r.useRef(),E=i||c;return r.useEffect(()=>(l.current&&(l.current.toTextArea(),l.current=null),l.current=CodeMirror.fromTextArea(E.current,{mode:"htmlmixed",theme:"sode",indentUnit:2,tabSize:2,lineNumbers:!0}),l.current.setSize(null,600),l.current.setValue(o),setTimeout(()=>{l.current.refresh()},125),l.current.on("change",m=>{const b=m.getValue();d(b),f({target:{value:b}})}),()=>{l.current&&(l.current.toTextArea(),l.current=null)}),[E]),r.useEffect(()=>{x!==o&&(d(o),l.current&&(l.current.setValue(o),setTimeout(()=>{l.current.refresh()},125)))},[o]),e.createElement("div",{className:`form-group ${n} mb-2`},a&&e.createElement("label",{htmlFor:"",className:"mb-1"},a," ",u&&e.createElement("b",{className:"text-danger"},"*")),e.createElement("textarea",{ref:E,className:"form-control",placeholder:h,required:u,rows:p,defaultValue:o,onChange:m=>d(m.target.value)}))},N=new H,U=({})=>{const n=r.useRef(),a=r.useRef(),i=r.useRef(),g=r.useRef(),h=r.useRef(),u=r.useRef(),p=r.useRef(),o=r.useRef(),f=r.useRef(),[x,d]=r.useState(!1),[c,l]=r.useState({}),[E,m]=r.useState(""),b=t=>{t!=null&&t.id?d(!0):d(!1),u.current.value=(t==null?void 0:t.id)||null,$(p.current).val((t==null?void 0:t.type)||null).trigger("change"),o.current.value=(t==null?void 0:t.name)||null,f.current.value=(t==null?void 0:t.description)||null,$(a.current).modal("show")},S=async t=>{const s=await N.get(t.id);l(s),m(s.content??""),$(i.current).modal("show")},C=async t=>{t.preventDefault();const s={id:u.current.value||void 0,type:p.current.value,name:o.current.value,description:f.current.value};await N.save(s)&&($(n.current).dxDataGrid("instance").refresh(),$(a.current).modal("hide"))},A=async t=>{t.preventDefault();const s=[...$("#permissions input:checked")].map(D=>D.value),v={role_id:c.id,permissions:s};await P.massiveByRole(v)&&($(i.current).modal("hide"),$(n.current).dxDataGrid("instance").refresh())},F=async t=>{const{isConfirmed:s}=await I.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!s||!await V.delete(t)||$(n.current).dxDataGrid("instance").refresh()};return r.useEffect(()=>{m((c==null?void 0:c.content)??""),console.log(h)},[c]),e.createElement(e.Fragment,null,e.createElement(W,{gridRef:n,title:"Plantillas",rest:N,toolBar:t=>{t.unshift(T({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(n.current).dxDataGrid("instance").refresh()})),t.unshift(T({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>b()}))},columns:[{dataField:"name",caption:"Nombre"},{dataField:"description",caption:"Descripcion"},{dataField:"type",caption:"Tipo"},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",cellTemplate:(t,{data:s})=>{t.text(moment(s.updated_at).format("LL"))}},{caption:"Acciones",cellTemplate:(t,{data:s})=>{t.attr("style","display: flex; gap: 4px; overflow: unset"),R(t,e.createElement(y,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>b(s)},e.createElement("i",{className:"fa fa-pen"}))),R(t,e.createElement(y,{className:"btn btn-xs btn-soft-dark",title:"Diseñar plantilla",onClick:()=>S(s),"data-loading-text":'<i className="fa fa-spinner fa-spin"></i>'},e.createElement("i",{className:"far fa-edit"}))),R(t,e.createElement(y,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>F(s.id)},e.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(k,{modalRef:a,title:x?"Editar plantilla":"Agregar plantilla",onSubmit:C,size:"sm"},e.createElement("div",{className:"row",id:"template-container"},e.createElement("input",{ref:u,type:"hidden"}),e.createElement(O,{eRef:p,label:"Tipo",dropdownParent:"#template-container",required:!0},e.createElement("option",{value:""},"- Seleccione una opcion -"),e.createElement("option",{value:"Email"},"Email"),e.createElement("option",{value:"WhatsApp"},"WhatsApp")),e.createElement(j,{eRef:o,label:"Nombre",required:!0}),e.createElement(L,{eRef:f,label:"Descripcion"}))),e.createElement(k,{modalRef:i,title:`Diseñador de plantillas - ${c.name}`,btnSubmitText:"Guardar",onSubmit:A,size:"xl"},e.createElement("ul",{className:"nav nav-pills navtab-bg justify-content-center flex-wrap gap-1"},e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#wysiwyg-editor","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link text-center active",style:{width:"200px"}},"Editor WYSIWYG")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#code-editor","data-bs-toggle":"tab","aria-expanded":"true",className:"nav-link text-center",style:{width:"200px"}},"Editor de codigo")),e.createElement("li",{className:"nav-item"},e.createElement("a",{href:"#dropzone","data-bs-toggle":"tab","aria-expanded":"false",className:"nav-link text-center",style:{width:"200px"}},"Carga tu archivo"))),e.createElement("div",{className:"tab-content"},e.createElement("div",{className:"tab-pane active",id:"wysiwyg-editor"},e.createElement(Y,{ref:g,apiKey:"to9eekrwr7478kpu5s95npp08yehwdh1o52wuuuo5n2msy8m",init:{plugins:["anchor","autolink","charmap","codesample","emoticons","image","link","lists","media","searchreplace","table","visualblocks","wordcount"],toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],ai_request:(t,s)=>s.string(()=>Promise.reject("See docs to implement AI Assistant")),height:"600px"},value:E,onEditorChange:t=>m(t)}),e.createElement("div",{className:"mb-2"})),e.createElement("div",{className:"tab-pane",id:"code-editor"},e.createElement(K,{editorRef:h,onChange:t=>m(t.target.value)})),e.createElement("div",{className:"tab-pane",id:"dropzone"},e.createElement("div",{className:"d-flex align-items-center justify-content-center mb-2 border",style:{height:"600px",borderRadius:"10px"}},e.createElement("div",null,e.createElement("input",{className:"d-none",id:"dropzone-file",type:"file",accept:"text/html,text/plain"}),e.createElement("button",{className:"d-block mx-auto mb-2 btn btn-sm btn-white rounded-pill waves-effect"},e.createElement("i",{className:"mdi mdi-paperclip me-1"}),"Seleccionar archivo"),e.createElement("label",{className:"d-block",htmlFor:"dropzone-file",style:{cursor:"pointer"}},"Arrastra y suelta tu plantilla aquí, o haz clic para seleccionar tu archivo HTML.")))))))};G((n,a)=>{M(n).render(e.createElement(q,{...a,title:"Plantillas"},e.createElement(U,{...a})))});
