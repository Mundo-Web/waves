var P=Object.defineProperty;var B=(n,a,r)=>a in n?P(n,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[a]=r;var p=(n,a,r)=>(B(n,typeof a!="symbol"?a+"":a,r),r);import{m as l,R as t,C as G,c as M,r as m}from"./CreateReactScript-BRBWlRTV.js";import{R as y}from"./ReactAppend-PRxIKL2F.js";import{P as R}from"./PermissionsRest-C1V16Wnt.js";import{i as L,A as _,S as j}from"./Adminto-BQEdF9zl.js";import{M as k}from"./Modal-CYscrTZ-.js";import{T as q,D as C}from"./DxPanelButton-j7iIpq-x.js";import{I as z}from"./InputFormGroup-Bwc1l4v7.js";import{T as I}from"./TextareaFormGroup-CQXxCfbs.js";import{T as w}from"./TippyButton-BFYLHq91.js";import"./server.browser-DGOuh5si.js";class d{}p(d,"paginate",async a=>{const{result:r}=await l.Fetch("/api/roles/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)});return r}),p(d,"byUser",async a=>{const{result:r}=await l.Fetch(`/api/roles/user/${a}`);return r.data??[]}),p(d,"save",async a=>{try{const{status:r,result:o}=await l.Fetch("/api/roles",{method:"POST",body:JSON.stringify(a)});if(!r)throw new Error((o==null?void 0:o.message)||"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}}),p(d,"status",async({id:a,status:r})=>{try{const{status:o,result:i}=await l.Fetch("/api/roles/status",{method:"PATCH",body:JSON.stringify({id:a,status:r})});if(!o)throw new Error((i==null?void 0:i.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:i.message,type:"success"}),!0}catch(o){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:o.message,type:"danger"}),!1}}),p(d,"delete",async a=>{try{const{status:r,result:o}=await l.Fetch(`/api/roles/${a}`,{method:"DELETE"});if(!r)throw new Error((o==null?void 0:o.message)??"Ocurrio un error inesperado");return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Correcto",body:o.message,type:"success"}),!0}catch(r){return l.Notify.add({icon:"/assets/img/logo-login.svg",title:"Error",body:r.message,type:"danger"}),!1}});const J=({title:n,id:a,parent:r,children:o,className:i,isOpened:u})=>t.createElement("div",{className:"card mb-1 border"},t.createElement("div",{className:"card-header p-0",id:`heading-${a}`},t.createElement("h5",{className:"m-0"},t.createElement("a",{className:`d-block text-dark ${!u&&"collapsed"} p-2`,"data-bs-toggle":"collapse",href:`#${a}`,"aria-expanded":"false"},n))),t.createElement("div",{id:a,className:`collapse ${u&&"show"}`,"aria-labelledby":`heading-${a}`,"data-bs-parent":`#${r}`},t.createElement("div",{className:`card-body p-2 ${i}`},o))),H=({title:n,label:a,id:r,name:o,value:i,checked:u,required:f,rounded:g=!1,style:v,className:h})=>t.createElement(L,{content:n,arrow:!0},t.createElement("div",{className:`form-check form-check-success ${h}`,style:{...v,cursor:"pointer"}},t.createElement("input",{className:`form-check-input ${g&&"rounded-circle"}`,type:"checkbox",value:i,name:o,id:r,defaultChecked:u,required:f,style:{cursor:"pointer"}}),t.createElement("label",{className:"form-check-label",htmlFor:r,style:{cursor:"pointer"}},a))),U=({permissions:n,can:a})=>{n=Object.values(n.map(e=>{const[s]=e.name.split(".");return{...e,origin:s}}).reduce((e,s)=>(e[s.origin]||(e[s.origin]=[]),e[s.origin].push(s),e),{}));const r=m.useRef(),o=m.useRef(),i=m.useRef();m.useRef();const u=m.useRef(),f=m.useRef(),g=m.useRef(),[v,h]=m.useState(!1),[x,T]=m.useState({}),N=e=>{e!=null&&e.id?h(!0):h(!1),u.current.value=(e==null?void 0:e.id)||null,f.current.value=(e==null?void 0:e.name)||null,g.current.value=(e==null?void 0:e.description)||null,$(o.current).modal("show")},S=async e=>{T(e);const s=await R.byRole(e.id);$("#permissions input").prop("checked",!1),s.forEach(({name:c})=>{$(`[name="${c}"]`).prop("checked",!0)}),$(i.current).modal("show")},F=async e=>{e.preventDefault();const s={id:u.current.value||void 0,name:f.current.value,description:g.current.value};await d.save(s)&&($(r.current).dxDataGrid("instance").refresh(),$(o.current).modal("hide"))},A=async e=>{e.preventDefault();const s=[...$("#permissions input:checked")].map(E=>E.value),c={role_id:x.id,permissions:s};await R.massiveByRole(c)&&($(i.current).modal("hide"),$(r.current).dxDataGrid("instance").refresh())},D=async e=>{const{isConfirmed:s}=await j.fire({title:"Eliminar rol",text:"¿Está seguro de eliminar este rol?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"});!s||!await d.delete(e)||$(r.current).dxDataGrid("instance").refresh()};return t.createElement(t.Fragment,null,t.createElement(q,{gridRef:r,title:"Roles",rest:d,toolBar:e=>{e.unshift(C({className:"btn btn-xs btn-soft-dark",text:"Actualizar",title:"Refrescar tabla",icon:"fas fa-undo-alt",onClick:()=>$(r.current).dxDataGrid("instance").refresh()})),a("roles","all","create")&&e.unshift(C({className:"btn btn-xs btn-soft-primary",text:"Nuevo",title:"Agregar registro",icon:"fa fa-plus",onClick:()=>N()}))},columns:[{dataField:"name",caption:"Rol"},{dataField:"description",caption:"Descripcion"},{dataField:"created_at",caption:"Fecha creacion",dataType:"date",width:"150px",cellTemplate:(e,{data:s})=>{y(e,t.createElement("span",null,moment(s.created_at).format("LL")))}},{dataField:"updated_at",caption:"Fecha actualizacion",dataType:"date",width:"150px",cellTemplate:(e,{data:s})=>{y(e,t.createElement("span",null,moment(s.updated_at).format("LL")))}},{caption:"Acciones",cellTemplate:(e,{data:s})=>{e.attr("style","display: flex; gap: 4px; overflow: unset"),y(e,t.createElement(w,{className:"btn btn-xs btn-soft-primary",title:"Editar",onClick:()=>N(s)},t.createElement("i",{className:"fa fa-pen"}))),y(e,t.createElement(w,{className:"btn btn-xs btn-soft-dark",title:"Modificar permisos",onClick:()=>S(s),"data-loading-text":'<i class="fa fa-spinner fa-spin"></i>'},t.createElement("i",{className:"fas fa-th-list"}))),y(e,t.createElement(w,{className:"btn btn-xs btn-soft-danger",title:"Eliminar",onClick:()=>D(s.id)},t.createElement("i",{className:"fa fa-trash-alt"})))},allowFiltering:!1,allowExporting:!1}]}),t.createElement(k,{modalRef:o,title:v?"Editar rol":"Agregar rol",onSubmit:F},t.createElement("div",{className:"row"},t.createElement("input",{ref:u,type:"hidden"}),t.createElement(z,{eRef:f,label:"Rol",col:"col-12",required:!0}),t.createElement(I,{eRef:g,label:"Descripcion",col:"col-12"}))),t.createElement(k,{modalRef:i,title:`Permisos para ${x.name}`,btnSubmitText:"Guardar",onSubmit:A,size:"lg"},t.createElement("div",{id:"permissions",className:"row"},n.map((e,s)=>{const c=e[0].origin;return t.createElement("div",{className:"col-lg-4 col-md-6 col-sm-12"},t.createElement(J,{key:`accordion-${s}`,id:`permission-${c}`,title:c,parent:"permissions",className:"d-flex gap-2 flex-wrap flex-row",isOpened:!0},e.map(({id:b,name:E,description:O})=>t.createElement(H,{key:`permission-${b}`,className:"mb-0",id:`permission-ck-${b}`,label:E.replace(`${c}.`,""),name:E,value:b,title:O,style:{width:"max-content"},rounded:!0}))))}))))};G((n,a)=>{M(n).render(t.createElement(_,{...a,title:"Roles"},t.createElement(U,{...a})))});
